name: deployment pipeline

on: 
  push: 
      branches: 
          - master
  pull_request:
      branches: [master]
      types: [opened, synchronize]
        

jobs: 
   simple_deployment_pipeline: 
      runs-on: ubuntu-latest
      steps: 
          - uses: actions/checkout@v3
          - uses: actions/setup-node@v3
            with:
              node-version: '16'
          
          - name: install dependencies
            run: npm install

          - name: Check style
            run:  npm run eslint
          
          - name: Build 
            run: npm run build 
          
          - name: test 
            run: npm test
  
          - name: deploy 
            if: ${{ github.event_name == 'push' }}
            uses: Bounceapp/render-action@0.7.1
            with:
              github-token: ${{ secrets.GIT_TOKEN }}
              render-token: ${{ secrets.RENDER_TOKEN }}
              service-id: srv-ckaqq2mgtj9c73a04rv0
   tag_release:
     runs-on: ubuntu-latest
     needs: [simple_deployment_pipeline]

     steps: 
       - name: Bump version and push tag 
         uses: anothrNick/github-tag-action@1.64.0 # Don't use @master or @v1 unless you're happy to test the latest version
         env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }
          DEFAULT_BUMP: patch   
            
